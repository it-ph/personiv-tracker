function accountsContentContainerController(t,e,a,n){function r(e){c.user.set("view",e);var a={controller:"userFormDialogController as vm",templateUrl:"/app/admin/templates/dialogs/user-form-dialog.template.html"};t.customDialog(a)}function o(e){function a(){c.user.get().then(function(t){c.user.set("user",t.data)}).catch(l)}c.user.set("edit",e);var n={controller:"editUserFormDialogController as vm",templateUrl:"/app/admin/templates/dialogs/edit-user-form-dialog.template.html"};t.customDialog(n).then(a)}function i(e){function a(){return t.preloader(),c.user.delete(e.id)}function n(){var t=c.user.user.subordinates.indexOf(e);c.user.user.subordinates.splice(t,1)}function r(){t.hide(),t.notify("User deleted.")}var o={title:"Delete",message:"Delete this user account?",ok:"Delete",cancel:"Cancel"};t.confirm(o).then(a).then(n).then(r).catch(l)}function s(e){var a={title:"Reset Password",message:"Password will be set as !welcome10",ok:"Reset Password",cancel:"Cancel"};t.confirm(a).then(function(){return c.user.resetPassword(e)}).then(function(){t.notify("Changes saved.")}).catch(l)}function l(){return t.error()}var c=this;c.user=e,c.edit=o,c.view=r,c.resetPassword=s,c.deleteUser=i,c.fab=a,c.fab.icon="mdi-plus",c.fab.show=!0,c.fab.label="Create User",c.fab.action=function(){c.user.showForm=!0,c.fab.show=!1}}function editUserFormDialogController(t,e,a,n,r,o){function i(){var t={where:[{column:"department_id",condition:"=",value:v.user.user.department_id}],relationships:["positions"]};return a.enlist(t)}function s(t){v.accounts=t.data}function l(){var t={where:[{column:"user_id",condition:"=",value:v.edit.id}],relationships:["account.positions"]};return n.enlist(t)}function c(t){angular.forEach(t.data,function(t){var e=o("filter")(v.accounts,{id:t.account_id});if(e){var a=v.accounts.indexOf(e[0]);e[0].selected=!0,v.accounts[a]=e[0];var n=o("filter")(v.accounts[a].positions,{id:t.position_id});if(n){var r=v.accounts[a].positions.indexOf(n[0]);n[0].date_started=new Date(t.date_started),n[0].selected=!0,v.accounts[a].positions[r]=n[0]}}})}function d(){var t={where:[{column:"employee_number",condition:"=",value:v.edit.employee_number}],whereNotIn:[{column:"id",values:[v.edit.id]}],withTrashed:!0,first:!0};v.user.enlist(t).then(function(t){v.duplicateEmployeeNumber=!!t.data})}function u(){var t={where:[{column:"email",condition:"=",value:v.edit.email}],whereNotIn:[{column:"id",values:[v.edit.id]}],withTrashed:!0,first:!0};v.user.enlist(t).then(function(t){v.duplicateEmail=!!t.data})}function m(){t.cancel()}function f(){v.showErrors=!0;var e=r.validate(v.form);!function(){angular.forEach(v.accounts,function(t){t.selected&&angular.forEach(t.positions,function(e){if(e.selected){var a={account_id:t.id,position_id:e.id,date_started:e.date_started};v.edit.experiences.push(a)}})})}(),h(),e||v.duplicateEmail||v.duplicateEmployeeNumber||!v.edit.experiences.length||(v.busy=!0,v.user.update(v.edit).then(function(){v.busy=!1,t.notify("Changes saved."),t.hide()}).catch(b))}function h(){angular.forEach(v.edit.experiences,function(t){t.date_started=t.date_started.toDateString()})}function p(){angular.forEach(v.edit.experiences,function(t){t.date_started=new Date(t.date_started)})}function b(){p(),t.reject(),v.busy=!1,v.error=!0}var v=this;v.label="Edit user",v.user=e,v.edit=v.user.clone("edit"),v.edit.experiences=[],v.checkEmployeeNumber=d,v.checkEmail=u,v.cancel=m,v.submit=f,function(){i().then(s).then(l).then(c).catch(b)}()}function userFormDialogController(t,e,a){function n(){t.hide()}var r=this;r.label=e.view.name,r.cancel=n,function(){var a={where:[{column:"id",condition:"=",value:e.view.id}],relationships:["experiences.account","experiences.position"],first:!0};e.enlist(a).then(function(t){r.user=t.data,angular.forEach(r.user.experiences,function(t){t.date_started=new Date(t.date_started)})}).catch(function(){t.error()})}()}function userFormController(t,e,a,n,r,o){function i(){h.user.showForm=!1,h.user.new={},h.fab.show=!0}function s(){angular.element(document).find("#newUser").addClass("md-input-focused"),angular.element(document).find("#newUser > input").focus()}function l(){var t={where:[{column:"department_id",condition:"=",value:h.user.user.department_id}],relationships:["positions"]};return a.enlist(t)}function c(){var t={where:[{column:"employee_number",condition:"=",value:h.user.new.employee_number}],withTrashed:!0,first:!0};h.user.enlist(t).then(function(t){h.duplicateEmployeeNumber=!!t.data})}function d(){var t={where:[{column:"email",condition:"=",value:h.user.new.email}],withTrashed:!0,first:!0};h.user.enlist(t).then(function(t){h.duplicateEmail=!!t.data})}function u(){function e(){h.busy=!1,t.notify("User created.")}function a(){return h.user.get().then(function(t){return h.user.set("user",t.data)})}h.showErrors=!0;var r=n.validate(h.form);!function(){angular.forEach(h.accounts,function(t){t.selected&&angular.forEach(t.positions,function(e){if(e.selected){var a={account_id:t.id,position_id:e.id,date_started:e.date_started};h.user.new.experiences.push(a)}})})}(),function(){angular.forEach(h.user.new.experiences,function(t){t.date_started=t.date_started.toDateString()})}(),r||h.duplicateEmail||h.duplicateEmployeeNumber||!h.user.new.experiences.length||(h.busy=!0,h.user.store().then(e).then(a).then(i).catch(m))}function m(){h.busy=!1,f(),t.error()}function f(){angular.forEach(h.user.new.experiences,function(t){t.date_started=new Date(t.date_started)})}var h=this;h.user=e,h.user.new={},h.user.new.experiences=[],h.fab=r,h.checkEmployeeNumber=c,h.checkEmail=d,h.focusOnForm=s,h.cancel=i,h.submit=u,function(){l().then(function(t){return h.accounts=t.data})}()}var admin=angular.module("app",["shared"]);admin.config(["$stateProvider",function(t){t.state("main",{url:"/",views:{"":{templateUrl:"/app/shared/views/main.view.html",controller:"mainViewController as mainVm"},"content-container@main":{templateUrl:"/app/shared/views/content-container.view.html",controller:"dashboardContentContainerController as vm"},"toolbar@main":{templateUrl:"/app/shared/templates/toolbar.template.html",controller:"dashboardToolbarController as vm"},"content@main":{templateUrl:"/app/admin/templates/content/dashboard-content.template.html"}},resolve:{authentication:["MaterialDesign","User","$state",function(t,e,a){return e.get().then(function(t){e.set("user",t.data)},function(){a.go("page-not-found")})}]}}).state("main.manage-users",{url:"users",views:{"content-container":{templateUrl:"/app/shared/views/content-container.view.html",controller:"accountsContentContainerController as vm"},"toolbar@main.manage-users":{templateUrl:"/app/shared/templates/toolbar.template.html",controller:"accountsToolbarController as vm"},"content@main.manage-users":{templateUrl:"/app/admin/templates/content/users-content.template.html"},"form@main.manage-users":{templateUrl:"/app/admin/templates/content/user-form.template.html",controller:"userFormController as vm"}}})}]),admin.controller("accountsContentContainerController",accountsContentContainerController),accountsContentContainerController.$inject=["MaterialDesign","User","fab","$q"],admin.controller("dashboardContentContainerController",["MaterialDesign","toolbarService","ShiftSchedule","Task","User","Chart",function(t,e,a,n,r,o){function i(){return d.task.dashboard().then(function(t){return d.isLoading=!1,d.task.data=t.data,d.task.data.length&&angular.forEach(d.task.data,function(t){s(t)}),d.task.data}).catch(l)}function s(t){var a={};a.display=t.name,e.items.push(a)}function l(){return t.failed().then(function(){i()}).catch(l)}function c(){d.dashboard(),d.isLoading=!0}var d=this;d.toolbar=e,d.task=n,d.user=r,d.chart=o,d.dashboard=i,d.init=c,d.init()}]),admin.controller("calendarDialogController",["MaterialDesign","ShiftSchedule","formService","Task",function(t,e,a,n){var r=this;r.label="Go to date",r.data={},r.cancel=function(){a.cancel()},r.toLocaleTimeString=function(){r.data.timeStart=r.data.timeStart.toLocaleTimeString(),r.data.timeEnd=r.data.timeEnd.toLocaleTimeString()},r.toDateString=function(){r.data.dateShift=r.data.dateShift.toDateString()},r.toDateObject=function(){var t=new Date;r.data.timeStart=new Date(t.toDateString()+" "+r.data.timeStart),r.data.timeEnd=new Date(t.toDateString()+" "+r.data.timeEnd),r.data.dateShift=new Date(r.data.dateShift)},r.data.dateShift=new Date,r.data.timeStart=a.timeFormat(new Date),r.data.timeEnd=a.timeFormat(new Date),r.submit=function(){a.validate(r.form)||(r.busy=!0,r.toLocaleTimeString(),r.toDateString(),n.dashboard(r.data).then(function(e){n.data=e.data,t.hide()},function(){t.error()}))}}]),admin.controller("downloadDialogController",["Department","User","MaterialDesign","formService","$window",function(t,e,a,n,r){function o(){return i.department.index().then(function(t){i.department.data=t.data}).catch(function(){a.error()})}var i=this;i.department=t,i.user=e,i.label="Download",i.data={},i.init=o,i.cancel=function(){n.cancel()},i.toLocaleTimeString=function(){i.data.time_start=i.data.time_start.toLocaleTimeString(),i.data.time_end=i.data.time_end.toLocaleTimeString()},i.toDateString=function(){i.data.date_start=i.data.date_start.toDateString(),i.data.date_end=i.data.date_end.toDateString()},i.toDateObject=function(){var t=new Date;i.data.time_start=new Date(t.toDateString()+" "+i.data.time_start),i.data.time_end=new Date(t.toDateString()+" "+i.data.time_end),i.data.date_start=new Date(i.data.date_start),i.data.date_end=new Date(i.data.date_end)},i.data.date_start=new Date,i.data.date_end=new Date,i.data.time_start=n.timeFormat(new Date),i.data.time_end=n.timeFormat(new Date),i.submit=function(){n.validate(i.form)||(i.busy=!0,i.toLocaleTimeString(),i.toDateString(),r.open("/task/download/"+i.data.date_start+"/to/"+i.data.date_end+"/at/"+i.data.time_start+"/until/"+i.data.time_end+"/department/"+i.data.department_id,"_blank"),a.hide())},i.init()}]),admin.controller("editUserFormDialogController",editUserFormDialogController),userFormController.$inject=["MaterialDesign","User","Account","Experience","formService","$filter"],admin.controller("settingsDialogController",["MaterialDesign","ShiftSchedule","formService",function(t,e,a){var n=this;n.label="Settings",n.shiftSchedule=e,n.cancel=function(){a.cancel()},n.submit=function(){if(!a.validate(n.form)){n.busy=!0,n.shiftSchedule.toLocaleTimeString();var e=function(){n.shiftSchedule.toDateObject(),n.busy=!1,t.error()};n.new?n.shiftSchedule.store().then(function(e){n.busy=!1,t.notify("Shift schedule saved."),t.hide()},function(){e()}):n.shiftSchedule.update().then(function(e){n.busy=!1,t.notify("Changes saved."),t.hide()},function(){e()})}},n.init=function(){n.shiftSchedule.index().then(function(t){t.data?(n.shiftSchedule.data=t.data,n.shiftSchedule.toDateObject()):(n.new=!0,n.shiftSchedule.init())},function(){t.error()})}()}]),admin.controller("userFormDialogController",userFormDialogController),userFormController.$inject=["MaterialDesign","User","formService"],admin.controller("accountsToolbarController",["MaterialDesign","toolbarService","User","$state",function(t,e,a,n){var r=this;r.toolbar=e,r.toolbar.content=a,r.toolbar.parentState=null,r.toolbar.childState="Accounts",r.toolbar.hideSearchIcon=!1,r.toolbar.searchAll=!1,r.toolbar.options=!1,r.toolbar.showInactive=!1,r.toolbar.state=n.current.name,r.sort=[{label:"Recently added",type:"created_at",sortReverse:!1}]}]),admin.controller("dashboardToolbarController",["MaterialDesign","toolbarService","Task","$state",function(t,e,a,n){var r=this;r.toolbar=e,r.toolbar.content=a,r.toolbar.parentState=null,r.toolbar.childState="Dashboard",r.toolbar.hideSearchIcon=!1,r.toolbar.searchAll=!1,r.toolbar.options=!1,r.toolbar.showInactive=!1,r.toolbar.state=n.current.name,r.sort=[{label:"Recently added",type:"created_at",sortReverse:!1}]}]),admin.controller("userFormController",userFormController),userFormController.$inject=["MaterialDesign","User","Account","formService","fab","$filter"];