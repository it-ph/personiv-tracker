var employee=angular.module("app",["shared"]);employee.config(["$stateProvider",function(t){t.state("main",{url:"/",views:{"":{templateUrl:"/app/shared/views/main.view.html",controller:"mainViewController as mainVm"},"content-container@main":{templateUrl:"/app/shared/views/content-container.view.html",controller:"homeContentContainerController as vm"},"toolbar@main":{templateUrl:"/app/shared/templates/toolbar.template.html",controller:"homeToolbarController as vm"},"form@main":{templateUrl:"/app/employee/templates/content/task-form.template.html",controller:"taskFormController as vm"},"content@main":{templateUrl:"/app/employee/templates/content/home-content.template.html"}},resolve:{authentication:["MaterialDesign","User","$state",function(t,e,n){return e.get().then(function(t){e.set("user",t.data)},function(){n.go("page-not-found")})}]}})}]),employee.factory("taskFormService",["$http","MaterialDesign","Task",function(t,e,n){var a={};return a.new={},a.store=function(){return t.post("/task",a.new)},a.update=function(){return t.put("/task/"+a.data.id,a.data)},a.setCurrent=function(t){n.formatData(t),n.current=t},a.set=function(t){a.data=t},a.setNumberofPhotos=function(t){a.numberOfPhotos=t},a.changeNumberOfPhotos=function(t){t.number_of_photos?(a.setNumberofPhotos(t.number_of_photos),t.number_of_photos=null):t.number_of_photos=a.numberOfPhotos},a.init=function(){a.data={},a.new={},a.numberOfPhotos=null},a}]),employee.controller("editTaskDialogController",["MaterialDesign","taskFormService","formService","Account","User","Experience","$filter",function(t,e,n,a,o,r,i){function s(){var t={where:[{column:"user_id",condition:"=",value:c.user.user.id},{column:"account_id",condition:"=",value:c.task.data.account_id}],relationships:["position"]};r.enlist(t).then(function(t){c.experiences=t.data}).catch(function(){Helper.error()})}var c=this;c.task=e,c.account=a,c.user=o,c.department=c.user.user.department.name,c.setAccount=function(t,e){var n=i("filter")(c.account.data,{id:t})[0];c.batchable=n.batchable,c.batchable||(c.task.data.number_of_photos=null),e&&(c.task.data.experience_id=null),s()},c.task.data.number_of_photos&&(c.batch=!0),c.accounts=function(){var t={where:[{column:"department_id",condition:"=",value:c.user.user.department_id}]};return c.account.enlist(t).then(function(t){return c.account.data=t.data},function(){Helper.error()})},c.cancel=function(){c.task.init(),n.cancel()},c.submit=function(){n.validate(c.taskForm)||(c.busy=!0,c.task.update().then(function(e){c.busy=!1,t.notify("Changes saved."),t.hide(),c.task.init()},function(){c.busy=!1,t.error()}))},c.init=function(){c.accounts().then(function(){c.setAccount(c.task.data.account_id,!1)})}()}]),function(){"use strict";function t(t,e,n,a,o,r){function i(){var t={where:[{column:"department_id",condition:"=",value:h.user.department_id}],relationships:["positions"]};return e.enlist(t)}function s(t){h.accounts=t.data}function c(){var t={where:[{column:"user_id",condition:"=",value:h.user.id}],relationships:["account.positions"]};return n.enlist(t)}function u(t){angular.forEach(t.data,function(t){var e=r("filter")(h.accounts,{id:t.account_id});if(e){var n=h.accounts.indexOf(e[0]);e[0].selected=!0,h.accounts[n]=e[0];var a=r("filter")(h.accounts[n].positions,{id:t.position_id});if(a){var o=h.accounts[n].positions.indexOf(a[0]);a[0].date_started=new Date(t.date_started),a[0].selected=!0,h.accounts[n].positions[o]=a[0]}}})}function l(){a.cancel()}function d(){h.showErrors=!0;var e=o.validate(h.form);!function(){angular.forEach(h.accounts,function(t){t.selected&&angular.forEach(t.positions,function(e){if(e.selected){var n={account_id:t.id,position_id:e.id,date_started:e.date_started};h.user.experiences.push(n)}})})}(),f(),e||h.duplicateEmail||h.duplicateEmployeeNumber||!h.user.experiences.length||(h.busy=!0,t.update(h.user).then(function(){h.busy=!1,a.notify("Changes saved."),a.hide()}).catch(m))}function f(){angular.forEach(h.user.experiences,function(t){t.date_started=t.date_started.toDateString()})}function p(){angular.forEach(h.user.experiences,function(t){t.date_started=new Date(t.date_started)})}function m(){p(),a.reject(),h.busy=!1,h.error=!0}var h=this;h.label="Positions",h.user=t.user,h.user.experiences=[],h.cancel=l,h.submit=d,function(){i().then(s).then(c).then(u).catch(m)}()}angular.module("app").controller("experiencesDialogController",t),t.$inject=["User","Account","Experience","MaterialDesign","formService","$filter"]}(),employee.controller("homeContentContainerController",["MaterialDesign","toolbarService","Task","taskFormService","User",function(t,e,n,a,o){function r(){var e={title:"Server Busy",message:"Your request is being processed."};t.alert(e)}var i=this,s=!1;i.toolbar=e,i.task=n,i.user=o,i.setCurrent=function(t){t&&(i.task.formatData(t),t.pauses.length&&(i.paused=!0,angular.forEach(t.pauses,function(t){i.task.formatData(t)})),i.task.current=t)},i.pause=function(){if(s)return r();s=!0,i.task.pause().then(function(e){i.paused=!0,i.setCurrent(e.data),t.notify("Paused"),s=!1},function(){s=!1,t.error()})},i.resume=function(){if(s)return r();s=!0,i.task.resume().then(function(e){i.paused=!1,i.setCurrent(e.data),t.notify("Resumed"),s=!1},function(){s=!1,t.error()})},i.finish=function(){var e={title:"Finish Task",message:"Are you sure you want to finsih this task? This action cannot be undone.",ok:"Finish",cancel:"Cancel"};t.confirm(e).then(function(){t.preloader(),i.task.finish().then(function(){t.hide(),t.notify("Task completed."),i.task.current=null,i.task.init(),i.paused=!1},function(){t.error()})})},i.edit=function(e){var n={templateUrl:"/app/employee/templates/dialogs/edit-task-dialog.template.html",controller:"editTaskDialogController as vm"};a.set(e),t.customDialog(n).then(function(){i.task.init()})},i.currentTask=function(){var e={relationships:["account","experience.position"],relationshipsWithConstraints:[{relationship:"pauses",whereNull:["ended_at"],orderBy:[{column:"created_at",order:"desc"}]}],whereNull:["ended_at"],where:[{column:"user_id",condition:"=",value:i.user.user.id}],first:!0};i.task.enlist(e).then(function(t){i.setCurrent(t.data)},function(){t.failed().then(function(){i.currentTask()})})},i.task.query={relationships:["account","experience.position"],whereNotNull:["ended_at"],where:[{column:"user_id",condition:"=",value:i.user.user.id}],orderBy:[{column:"created_at",order:"desc"}],paginate:20},i.completedTasks=function(){i.task.enlist(i.task.query).then(function(t){i.nextPage=2,i.pagination=t.data,i.task.data=t.data.data,i.show=!0,i.isLoading=!1,i.task.data.length&&angular.forEach(i.task.data,function(t){i.task.formatData(t),i.task.setToolbarItems(t)}),i.loadNextPage=function(){if(i.busy||i.nextPage>i.pagination.last_page)return void(i.isLoading=!1);i.busy=!0,i.isLoading=!0,i.task.paginate(i.task.query,i.nextPage).then(function(t){i.nextPage++,angular.forEach(t.data.data,function(t){i.task.formatData(t),i.task.pushItem(t),i.task.setToolbarItems(t)}),i.busy=!1,i.isLoading=!1},function(){i.loadNextPage()})}},function(){t.failed().then(function(){i.completedTasks()})})},i.task.init=function(){i.show=!1,i.isLoading=!0,i.toolbar.clearItems(),i.currentTask(),i.completedTasks()},i.task.init()}]),employee.controller("taskFormController",["MaterialDesign","taskFormService","formService","User","Account","Experience",function(t,e,n,a,o,r){function i(){var t={where:[{column:"user_id",condition:"=",value:s.user.user.id},{column:"account_id",condition:"=",value:s.task.new.account_id}],relationships:["position"]};r.enlist(t).then(function(t){s.experiences=t.data}).catch(function(){Helper.failed().then(function(){i()})})}var s=this;s.task=e,s.account=o,s.user=a,s.task.new.revision=!1,s.setAccount=function(){s.task.new.account_id=s.task.new.account.id,s.batchable=s.task.new.account.batchable,s.task.new.experience_id=null,i()},s.accounts=function(){var t={where:[{column:"department_id",condition:"=",value:s.user.user.department_id}]};s.account.enlist(t).then(function(t){s.account.data=t.data},function(){Helper.failed().then(function(){s.accounts()})})},s.submit=function(){n.validate(s.form)||(s.busy=!0,s.task.store().then(function(e){s.busy=!1,t.notify("Task created."),s.task.setCurrent(e.data),s.task.init()},function(){s.busy=!1,t.error()}))},s.init=function(){s.accounts()}()}]),employee.controller("homeToolbarController",["MaterialDesign","toolbarService","Task",function(t,e,n){var a=this;a.toolbar=e,a.toolbar.content=n,a.toolbar.parentState=null,a.toolbar.childState="Home",a.toolbar.hideSearchIcon=!1,a.toolbar.searchAll=!0,a.toolbar.options=!0,a.toolbar.showInactive=!1,a.sort=[{label:"Recently added",type:"created_at",sortReverse:!1}]}]);