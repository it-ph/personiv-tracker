var shared=angular.module("shared",["ui.router","ngMaterial","ngMessages","infinite-scroll","highcharts-ng","angularMoment","angularFileUpload","ui.bootstrap"]);shared.config(["$urlRouterProvider","$stateProvider","$mdThemingProvider","$qProvider",function(e,t,r,a){a.errorOnUnhandledRejections(!1),r.theme("default").primaryPalette("indigo").accentPalette("amber"),r.theme("dark-purple").backgroundPalette("deep-purple").dark(),r.theme("dark-orange").backgroundPalette("orange").dark(),e.otherwise("/page-not-found").when("","/"),t.state("page-not-found",{url:"/page-not-found",templateUrl:"/app/shared/views/page-not-found.view.html"})}]),shared.factory("Account",["$http","MaterialDesign",function(e,t){var r={};return r.data=[],r.enlist=function(t){return e.post("/account/enlist",t)},r}]),shared.factory("Chart",function(){var e={};return e.data={title:{},subtitle:{},xAxis:{crosshair:!0},yAxis:[{min:0,title:{text:"Compeleted Tasks"}}],plotOptions:{column:{dataLabels:{enabled:!0},enableMouseTracking:!0}},series:[{name:"New",type:"column"},{name:"Revisions",type:"column"}],navigation:{buttonOptions:{enabled:!0}}},e.config=function(t){return e.data.title.text=t.name,e.data.subtitle.text=t.range,e.data.xAxis.categories=t.categories,e.data.series[0].data=t.new,e.data.series[1].data=t.revisions,e.data},e}),shared.factory("Department",["$http",function(e){function t(){return e.get("department")}return{data:[],index:t}}]),shared.factory("changePasswordService",["$http","MaterialDesign",function(e,t){var r={};return r.verifyPassword=function(){return e.post("/user/verify-password",r.data)},r.cancel=function(){r.init(),t.cancel()},r.submit=function(){return e.post("/user/change-password",r.data)},r.init=function(){r.data={}},r}]),shared.factory("formService",["MaterialDesign",function(e){var t={};return t.validate=function(e){if(e.$invalid)return angular.forEach(e.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}),!0},t.cancel=function(){e.cancel()},t.timeFormat=function(e){return e.getMinutes()<30?e.setMinutes(30):e.getMinutes()>30&&(e.setHours(e.getHours()+1),e.setMinutes(0)),e.setSeconds(0),e},t}]),shared.factory("MaterialDesign",["$mdDialog","$mdToast",function(e,t){var r={};return r.alert=function(t){return e.show(e.alert().parent(angular.element($("body"))).clickOutsideToClose(!0).title(t.title).textContent(t.message).ariaLabel(t.title).ok("Got it!"))},r.customDialog=function(t){var r={controller:t.controller,templateUrl:t.templateUrl,parent:angular.element(document.body),fullscreen:t.fullscreen};return e.show(r)},r.confirm=function(t){var r=e.confirm().title(t.title).textContent(t.message).ariaLabel(t.title).ok(t.ok).cancel(t.cancel);return e.show(r)},r.prompt=function(t){var r=e.prompt().title(t.title).textContent(t.message).placeholder(t.placeholder).ariaLabel(t.title).ok(t.ok).cancel(t.cancel);return e.show(r)},r.notify=function(e){var r=t.simple().textContent(e).position("bottom right").hideDelay(3e3);return t.show(r)},r.preloader=function(){e.show({templateUrl:"/app/shared/templates/loading.template.html",parent:angular.element(document.body)})},r.cancel=function(){return e.cancel()},r.hide=function(t){return e.hide(t)},r.error=function(){var e={title:"Oops! Something went wrong!",message:"An error occured. Please try again later."};return r.alert(e)},r.failed=function(){var e={title:"Aw Snap!",message:"An error occured loading the resource.",ok:"Try Again"};return r.confirm(e)},r}]),shared.factory("ShiftSchedule",["$http","MaterialDesign","formService",function(e,t,r){var a={};return a.data={},a.index=function(){return e.get("/shift-schedule")},a.store=function(){return e.post("/shift-schedule",a.data)},a.update=function(){return e.put("/shift-schedule/"+a.data.id,a.data)},a.toLocaleTimeString=function(){a.data.from=a.data.from.toLocaleTimeString(),a.data.to=a.data.to.toLocaleTimeString()},a.toDateObject=function(){var e=new Date;a.data.from=new Date(e.toDateString()+" "+a.data.from),a.data.to=new Date(e.toDateString()+" "+a.data.to)},a.init=function(){var e=new Date;a.data={},a.data.from=r.timeFormat(e),a.data.to=r.timeFormat(e)},a}]),shared.factory("Task",["$http","MaterialDesign","toolbarService",function(e,t,r){var a={};return a.data=[],a.search=function(e){a.query.search=e,a.init()},a.refresh=function(){a.query.search=null,a.init()},a.enlist=function(t){return e.post("/task/enlist",t)},a.paginate=function(t,r){return e.post("/task/enlist?page="+r,t)},a.pause=function(){return e.post("/task/pause/"+a.current.id)},a.resume=function(){return e.post("/task/resume/"+a.current.id,a.current.pauses[0])},a.dashboard=function(t){return e.post("/task/dashboard",t)},a.finish=function(){return e.post("/task/finish/"+a.current.id,a.current.pauses.length?a.current.pauses[0]:null)},a.delete=function(t){return e.delete("/task/"+t)},a.formatData=function(e){e.created_at=new Date(e.created_at),e.ended_at=e.ended_at?new Date(e.ended_at):null},a.pushItem=function(e){a.data.push(e)},a.setToolbarItems=function(e){var t={};t.display=e.title,t.date=new Date(e.created_at).toDateString()+new Date(e.ended_at).toDateString(),r.items.push(t)},a}]),shared.factory("toolbarService",["$http","$filter","MaterialDesign",function(e,t,r){var a={};return a.items=[],a.showSearchBar=function(){a.searchBar=!0},a.hideSearchBar=function(){a.searchBar=!1,a.searchText="",a.searchItem="",a.refresh()},a.getItems=function(e){return e?t("filter")(a.items,e):a.items},a.sortBy=function(e){e.sortReverse=!e.sortReverse,a.sortType=e.type,a.sortReverse=e.sortReverse},a.toggleActive=function(){a.showInactive=!a.showInactive.showInactive},a.searchUserInput=function(e){a.content.search(e)},a.refresh=function(){a.content.refresh()},a.clearItems=function(){a.items=[]},a.calendar=function(){var e={templateUrl:"/app/admin/templates/dialogs/calendar-dialog.template.html",controller:"calendarDialogController as vm"};r.customDialog(e)},a.settings=function(){var e={templateUrl:"/app/admin/templates/dialogs/settings-dialog.template.html",controller:"settingsDialogController as vm"};r.customDialog(e)},a.download=function(){var e={templateUrl:"/app/admin/templates/dialogs/download-dialog.template.html",controller:"downloadDialogController as vm"};r.customDialog(e)},a}]),shared.factory("User",["$http","$state","MaterialDesign","FileUploader",function(e,t,r,a){var n={};return n.user={},n.currentTime=Date.now(),n.get=function(){return e.post("/user/check")},n.set=function(e){n.user=e},n.logout=function(){return e.post("/user/logout")},n.checkDefaultPassword=function(){return e.post("/user/check-default-password")},n.changePassword=function(){var e={controller:"changePasswordDialogController as vm",templateUrl:"/app/shared/templates/dialogs/change-password-dialog.template.html"};return r.customDialog(e)},n.uploader={},n.uploader.filter={name:"photoFilter",fn:function(e,t){var r="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(r)!==-1}},n.uploader.sizeFilter={name:"enforceMaxFileSize",fn:function(e){return e.size<=2e6}},n.uploader.error=function(e,t,a){r.error(),n.photoUploader.queue=[]},n.headers={"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},n.photoUploaderInit=function(){n.photoUploader=new a({url:"/user/upload-avatar/"+n.user.id,headers:n.headers,queueLimit:1}),n.photoUploader.filters.push(n.uploader.filter),n.photoUploader.filters.push(n.uploader.sizeFilter),n.photoUploader.onWhenAddingFileFailed=n.uploader.error,n.photoUploader.onAfterAddingFile=function(){n.photoUploader.queue.length&&n.photoUploader.uploadAll()},n.photoUploader.onCompleteItem=function(e,r){n.user.avatar_path?(n.currentTime=Date.now(),n.photoUploader.queue=[]):t.go(t.current,{},{reload:!0})},n.showUploader=!0},n}]),shared.controller("changePasswordDialogController",["User","MaterialDesign","changePasswordService",function(e,t,r){var a=this;a.service=r,a.service.init(),a.verifyPassword=function(){a.service.verifyPassword().then(function(e){a.match=e.data,a.show=!0},function(){a.error=!0})},a.submit=function(){if(a.changePasswordForm.$invalid)return void angular.forEach(a.changePasswordForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})});a.service.data.old!=a.service.data.new&&a.service.data.new==a.service.data.confirm&&(a.busy=!0,a.service.submit().then(function(){a.busy=!1,a.service.init(),t.hide(),t.notify("Password changed.")},function(){a.error=!0}))}}]),shared.controller("mainViewController",["User","MaterialDesign",function(e,t){var r=this;r.user=e,r.logout=function(){r.user.logout().then(function(){window.location.href="/"})},r.clickUpload=function(){angular.element("#upload").trigger("click")},r.markAsRead=function(e){r.user.markAsRead().then(function(){r.user.removeNotification(e)},function(){t.error()})},r.markAllAsRead=function(){r.user.markAllAsRead().then(function(){r.user.clearNotifications()},function(){t.error()})},r.forceChangePassword=function(){var e={title:"Change Password",message:"Please change your default password.",ok:"Got it!"};t.confirm(e).then(function(){r.user.changePassword().then(function(){t.hide()},function(){r.forceChangePassword()})},function(){r.logout()})};!function(){r.user.checkDefaultPassword().then(function(e){e.data&&r.forceChangePassword()})}()}]);