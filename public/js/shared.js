var shared=angular.module("shared",["ui.router","ngMaterial","ngMessages","infinite-scroll","highcharts-ng","angularMoment","angularFileUpload","ui.bootstrap"]);shared.config(["$urlRouterProvider","$stateProvider","$mdThemingProvider","$qProvider",function(e,t,a,r){r.errorOnUnhandledRejections(!1),a.theme("default").primaryPalette("indigo").accentPalette("amber"),a.theme("dark-purple").backgroundPalette("deep-purple").dark(),a.theme("dark-orange").backgroundPalette("orange").dark(),e.otherwise("/page-not-found").when("","/"),t.state("page-not-found",{url:"/page-not-found",templateUrl:"/app/shared/views/page-not-found.view.html"})}]),shared.factory("Account",["$http","MaterialDesign",function(e,t){var a={};return a.data=[],a.enlist=function(t){return e.post("/account/enlist",t)},a}]),shared.factory("Chart",function(){var e={};return e.data={title:{},subtitle:{},xAxis:{crosshair:!0},yAxis:[{min:0,title:{text:"Compeleted Tasks"}},{min:0,title:{text:"Hours Worked"},labels:{format:"{value} hrs."},opposite:!0}],plotOptions:{column:{dataLabels:{enabled:!0},enableMouseTracking:!0}},series:[{name:"New",type:"column"},{name:"Revisions",type:"column"},{name:"Hours Spent",type:"spline",yAxis:1,tooltip:{valueSuffix:" hrs."}}],navigation:{buttonOptions:{enabled:!0}}},e.config=function(t){return e.data.title.text=t.name,e.data.subtitle.text=t.range,e.data.xAxis.categories=t.categories,e.data.series[0].data=t.new,e.data.series[1].data=t.revisions,e.data.series[2].data=t.hours_spent,e.data},e}),shared.factory("changePasswordService",["$http","MaterialDesign",function(e,t){var a={};return a.verifyPassword=function(){return e.post("/user/verify-password",a.data)},a.cancel=function(){a.init(),t.cancel()},a.submit=function(){return e.post("/user/change-password",a.data)},a.init=function(){a.data={}},a}]),shared.factory("formService",["MaterialDesign",function(e){var t={};return t.validate=function(e){if(e.$invalid)return angular.forEach(e.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}),!0},t.cancel=function(){e.cancel()},t.timeFormat=function(e){return e.getMinutes()<30?e.setMinutes(30):e.getMinutes()>30&&(e.setHours(e.getHours()+1),e.setMinutes(0)),e.setSeconds(0),e},t}]),shared.factory("MaterialDesign",["$mdDialog","$mdToast",function(e,t){var a={};return a.alert=function(t){return e.show(e.alert().parent(angular.element($("body"))).clickOutsideToClose(!0).title(t.title).textContent(t.message).ariaLabel(t.title).ok("Got it!"))},a.customDialog=function(t){var a={controller:t.controller,templateUrl:t.templateUrl,parent:angular.element(document.body),fullscreen:t.fullscreen};return e.show(a)},a.confirm=function(t){var a=e.confirm().title(t.title).textContent(t.message).ariaLabel(t.title).ok(t.ok).cancel(t.cancel);return e.show(a)},a.prompt=function(t){var a=e.prompt().title(t.title).textContent(t.message).placeholder(t.placeholder).ariaLabel(t.title).ok(t.ok).cancel(t.cancel);return e.show(a)},a.notify=function(e){var a=t.simple().textContent(e).position("bottom right").hideDelay(3e3);return t.show(a)},a.preloader=function(){e.show({templateUrl:"/app/shared/templates/loading.template.html",parent:angular.element(document.body)})},a.cancel=function(){return e.cancel()},a.hide=function(t){return e.hide(t)},a.error=function(){var e={title:"Oops! Something went wrong!",message:"An error occured. Please try again later."};return a.alert(e)},a.failed=function(){var e={title:"Aw Snap!",message:"An error occured loading the resource.",ok:"Try Again"};return a.confirm(e)},a}]),shared.factory("ShiftSchedule",["$http","MaterialDesign","formService",function(e,t,a){var r={};return r.data={},r.index=function(){return e.get("/shift-schedule")},r.store=function(){return e.post("/shift-schedule",r.data)},r.update=function(){return e.put("/shift-schedule/"+r.data.id,r.data)},r.toLocaleTimeString=function(){r.data.from=r.data.from.toLocaleTimeString(),r.data.to=r.data.to.toLocaleTimeString()},r.toDateObject=function(){var e=new Date;r.data.from=new Date(e.toDateString()+" "+r.data.from),r.data.to=new Date(e.toDateString()+" "+r.data.to)},r.init=function(){var e=new Date;r.data={},r.data.from=a.timeFormat(e),r.data.to=a.timeFormat(e)},r}]),shared.factory("Task",["$http","MaterialDesign","toolbarService",function(e,t,a){var r={};return r.data=[],r.search=function(e){r.query.search=e,r.init()},r.refresh=function(){r.query.search=null,r.init()},r.enlist=function(t){return e.post("/task/enlist",t)},r.paginate=function(t,a){return e.post("/task/enlist?page="+a,t)},r.pause=function(){return e.post("/task/pause/"+r.current.id)},r.resume=function(){return e.post("/task/resume/"+r.current.id,r.current.pauses[0])},r.dashboard=function(t){return e.post("/task/dashboard",t)},r.finish=function(){return e.post("/task/finish/"+r.current.id,r.current.pauses.length?r.current.pauses[0]:null)},r.delete=function(t){return e.delete("/task/"+t)},r.formatData=function(e){e.created_at=new Date(e.created_at),e.ended_at=e.ended_at?new Date(e.ended_at):null},r.pushItem=function(e){r.data.push(e)},r.setToolbarItems=function(e){var t={};t.display=e.title,t.date=new Date(e.created_at).toDateString()+new Date(e.ended_at).toDateString(),a.items.push(t)},r}]),shared.factory("toolbarService",["$http","$filter","MaterialDesign",function(e,t,a){var r={};return r.items=[],r.showSearchBar=function(){r.searchBar=!0},r.hideSearchBar=function(){r.searchBar=!1,r.searchText="",r.searchItem="",r.refresh()},r.getItems=function(e){return e?t("filter")(r.items,e):r.items},r.sortBy=function(e){e.sortReverse=!e.sortReverse,r.sortType=e.type,r.sortReverse=e.sortReverse},r.toggleActive=function(){r.showInactive=!r.showInactive.showInactive},r.searchUserInput=function(e){r.content.search(e)},r.refresh=function(){r.content.refresh()},r.clearItems=function(){r.items=[]},r.calendar=function(){var e={templateUrl:"/app/admin/templates/dialogs/calendar-dialog.template.html",controller:"calendarDialogController as vm"};a.customDialog(e)},r.settings=function(){var e={templateUrl:"/app/admin/templates/dialogs/settings-dialog.template.html",controller:"settingsDialogController as vm"};a.customDialog(e)},r.download=function(){var e={templateUrl:"/app/admin/templates/dialogs/download-dialog.template.html",controller:"downloadDialogController as vm"};a.customDialog(e)},r}]),shared.factory("User",["$http","$state","MaterialDesign","FileUploader",function(e,t,a,r){var n={};return n.user={},n.currentTime=Date.now(),n.get=function(){return e.post("/user/check")},n.set=function(e){n.user=e},n.pusher=function(){var e=new Pusher("f4ec05090428ca64a977",{encrypted:!0,auth:{headers:{"X-CSRF-Token":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}}),r={};r.user=e.subscribe("private-App.User."+n.user.id),r.user.bindings=[r.user.bind("Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",function(e){e.created_at=e.attachment.created_at,e.data={},e.data.attachment=e.attachment,e.data.url=e.url,e.data.withParams=e.withParams,e.data.sender=e.sender,e.data.message=e.message,n.user.unread_notifications.unshift(e),a.notify(e.sender.name+" "+e.message),t.current.name==e.data.url&&t.go(t.current,{},{reload:!0})})]},n.markAsRead=function(t){return e.post("/user/mark-as-read",t)},n.removeNotifications=function(e){var t=n.user.unread_notifications.indexOf(e);n.user.unread_notifications.splice(t,1)},n.markAllAsRead=function(){return e.post("/user/mark-all-as-read")},n.read=function(e){t.go(e.data.url),n.markAsRead(e)},n.clearNotifications=function(){n.user.unread_notifications=[]},n.logout=function(){return e.post("/user/logout")},n.checkDefaultPassword=function(){return e.post("/user/check-default-password")},n.changePassword=function(){var e={controller:"changePasswordDialogController as vm",templateUrl:"/app/shared/templates/dialogs/change-password-dialog.template.html"};return a.customDialog(e)},n.uploader={},n.uploader.filter={name:"photoFilter",fn:function(e,t){var a="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(a)!==-1}},n.uploader.sizeFilter={name:"enforceMaxFileSize",fn:function(e){return e.size<=2e6}},n.uploader.error=function(e,t,r){a.error(),n.photoUploader.queue=[]},n.headers={"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},n.photoUploaderInit=function(){n.photoUploader=new r({url:"/user/upload-avatar/"+n.user.id,headers:n.headers,queueLimit:1}),n.photoUploader.filters.push(n.uploader.filter),n.photoUploader.filters.push(n.uploader.sizeFilter),n.photoUploader.onWhenAddingFileFailed=n.uploader.error,n.photoUploader.onAfterAddingFile=function(){n.photoUploader.queue.length&&n.photoUploader.uploadAll()},n.photoUploader.onCompleteItem=function(e,a){n.user.avatar_path?(n.currentTime=Date.now(),n.photoUploader.queue=[]):t.go(t.current,{},{reload:!0})},n.showUploader=!0},n}]),shared.controller("changePasswordDialogController",["User","MaterialDesign","changePasswordService",function(e,t,a){var r=this;r.service=a,r.service.init(),r.verifyPassword=function(){r.service.verifyPassword().then(function(e){r.match=e.data,r.show=!0},function(){r.error=!0})},r.submit=function(){if(r.changePasswordForm.$invalid)return void angular.forEach(r.changePasswordForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})});r.service.data.old!=r.service.data.new&&r.service.data.new==r.service.data.confirm&&(r.busy=!0,r.service.submit().then(function(){r.busy=!1,r.service.init(),t.hide(),t.notify("Password changed.")},function(){r.error=!0}))}}]),shared.controller("mainViewController",["User","MaterialDesign",function(e,t){var a=this;a.user=e,a.logout=function(){a.user.logout().then(function(){window.location.href="/"})},a.clickUpload=function(){angular.element("#upload").trigger("click")},a.markAsRead=function(e){a.user.markAsRead().then(function(){a.user.removeNotification(e)},function(){t.error()})},a.markAllAsRead=function(){a.user.markAllAsRead().then(function(){a.user.clearNotifications()},function(){t.error()})},a.forceChangePassword=function(){var e={title:"Change Password",message:"Please change your default password.",ok:"Got it!"};t.confirm(e).then(function(){a.user.changePassword().then(function(){t.hide()},function(){a.forceChangePassword()})},function(){a.logout()})};!function(){a.user.checkDefaultPassword().then(function(e){e.data&&a.forceChangePassword()}),a.user.photoUploaderInit()}()}]);